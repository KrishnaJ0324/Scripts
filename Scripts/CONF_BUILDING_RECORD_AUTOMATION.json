{
  "Building/Street Cut/Tree_Removal/NA": {
    "WorkflowTaskUpdateAfter": [
      {
        "metadata": {
          "description": "Automatically assess a fee when the Completeness Check task is set to Correction Required",
          "operators": {},
          "errorHandling": "retry",
          "maxRetries": 3,
          "retryDelay": 5000,
          "configurableFees": true
        },
        "preScript": "if (hasExistingFee(getFeeCode(applicationType))) { skipAction('Duplicate fee already exists'); }",
        "criteria": {
          "allowBalance": false,
          "task": [
            "Completeness Check"
          ],
          "status": [
            "Correction Required"
          ]
        },
        "action": {
          "assessFees": [
            {
              "feeSchedule": "${config.feeSchedules[applicationType] || 'DEFAULT_ARTS_APP'}",
              "feeCode": "${getFeeCode(applicationType)}",
              "feeQuantity": "${calculateFeeQuantity(applicationType, severity)}",
              "feeInvoice": "Y",
              "feePeriod": "FINAL",
              "feeAmount": "${getFeeAmount(applicationType, severity)}"
            }
          ],
          "notifications": [
            {
              "type": "email",
              "template": "fee_assessment_notification",
              "recipients": [
                "applicant",
                "reviewer"
              ],
              "data": {
                "feeAmount": "${getFeeAmount(applicationType, severity)}",
                "feeCode": "${getFeeCode(applicationType)}"
              }
            }
          ],
          "feeWaivers": {
            "enabled": true,
            "conditions": [
              "firstTimeApplicant",
              "lowIncomeQualified",
              "emergencyPermit"
            ]
          }
        },
        "postScript": "logAction('fee_assessed', {task: criteria.task, status: criteria.status, applicationType: applicationType, feeAmount: getFeeAmount(applicationType, severity), timestamp: new Date()}); notifyApplicant('Fee assessed for correction required - Amount: $' + getFeeAmount(applicationType, severity) + ' - please check your email for details');"
      }
    ]
  },
  "Building/Electrical/Residential/NA": {
    "WorkflowTaskUpdateAfter": [
      {
        "metadata": {
          "description": "Assess a re-inspection fee for failed electrical inspections",
          "operators": {}
        },
        "preScript": "if (wfTask == 'Electrical Inspection' && wfStatus == 'Failed') { // logic to check if re-inspection fee already exists }",
        "criteria": {
          "allowBalance": false,
          "task": [
            "Electrical Inspection"
          ],
          "status": [
            "Failed"
          ]
        },
        "action": {
          "assessFees": [
            {
              "feeSchedule": "ELEC_INSP",
              "feeCode": "ELEC_REINSP",
              "feeQuantity": 1,
              "feeInvoice": "Y",
              "feePeriod": "FINAL"
            }
          ]
        },
        "postScript": "logAction('Re-inspection fee assessed for failed electrical inspection.'); UPDATED"
      }
    ]
  },
  "Building/plumbing/Residential/NA": {
    "WorkflowTaskUpdateAfter": [
      {
        "metadata": {
          "description": "Assess a re-inspection fee for failed electrical inspections",
          "operators": {}
        },
        "preScript": "if (wfTask == 'Electrical Inspection' && wfStatus == 'Failed') { // logic to check if re-inspection fee already exists }",
        "criteria": {
          "allowBalance": false,
          "task": [
            "Electrical Inspection"
          ],
          "status": [
            "Failed"
          ]
        },
        "action": {
          "assessFees": [
            {
              "feeSchedule": "ELEC_INSP",
              "feeCode": "ELEC_REINSP",
              "feeQuantity": 1,
              "feeInvoice": "Y",
              "feePeriod": "FINAL"
            }
          ]
        },
        "postScript": "logAction('Re-inspection fee assessed for failed electrical inspection.'); UPDATED"
      }
    ]
  },
  "Planning/Residential/New/NA": {
    "ApplicationSubmitAfter": [
      {
        "metadata": {
          "description": "Upon submission, check Permit Type, then update ASI and notify.",
          "operators": {}
        },
        "preScript": "if (AInfo['Permit Type'] != 'New Construction') { cancel = true; }",
        "criteria": {},
        "action": {
          "updateASI": {
            "asiGroup": "SUBMITTAL_INFO",
            "asiSubGroup": null,
            "asiLabel": "Submission Status",
            "asiValue": "Received"
          },
          "notifications": [
            {
              "type": "email",
              "template": "PLN_APP_RECEIVED",
              "recipients": [
                "planning_group",
                "applicant"
              ]
            }
          ]
        },
        "postScript": "logDebug('New Construction application received and processed.');"
      },
      {
        "metadata": {
          "description": "Upon submission, update ASI and notify planning staff.",
          "operators": {},
          "id": "167f06ac-3976-4c1f-b485-385fbc6e96d3"
        },
        "preScript": "",
        "criteria": {},
        "action": {
          "updateASI": {
            "asiGroup": "SUBMITTAL_INFO",
            "asiSubGroup": null,
            "asiLabel": "Submission Status",
            "asiValue": "Received"
          },
          "notifications": [
            {
              "type": "email",
              "template": "PLN_APP_RECEIVED",
              "recipients": [
                "planning_group",
                "applicant"
              ]
            }
          ]
        },
        "postScript": "logDebug('Application received and processed.');"
      },
      {
        "metadata": {
          "description": "Upon submission, check Permit Type, then update ASI and notify.",
          "operators": {},
          "id": "2b635663-fcfd-43c3-8c0a-a4d99266c2e3"
        },
        "preScript": "if (AInfo['Permit Type'] != 'New Construction') { cancel = true; }",
        "criteria": {},
        "action": {
          "updateASI": {
            "asiGroup": "SUBMITTAL_INFO",
            "asiSubGroup": null,
            "asiLabel": "Submission Status",
            "asiValue": "Received"
          },
          "notifications": [
            {
              "type": "email",
              "template": "PLN_APP_RECEIVED",
              "recipients": [
                "planning_group",
                "applicant"
              ]
            }
          ]
        },
        "postScript": "logDebug('New Construction application received and processed.');"
      }
    ]
  }
}